<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Progress Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f8f9fa; }
    .card { margin-bottom: 20px; }
    .progress-bar { font-weight: bold; }
  </style>
</head>
<body>
<div class="container mt-4">
  <h1 class="mb-4">📊 Progress Dashboard</h1>

  <!-- Flash Messages -->
  <% if(success_msg){ %>
    <div class="alert alert-success"><%= success_msg %></div>
  <% } %>
  <% if(error_msg){ %>
    <div class="alert alert-danger"><%= error_msg %></div>
  <% } %>

  <!-- Progress Overview -->
  <div class="card">
    <div class="card-header bg-primary text-white">Your Progress</div>
    <div class="card-body">
      <% if(progress.length > 0){ %>
        <% progress.forEach(p => { %>
          <div class="mb-3">
            <strong><%= p.subject %></strong>
            <div class="progress">
              <div class="progress-bar bg-success" 
                   role="progressbar" 
                   style="width: <%= p.percentage %>%;">
                <%= p.percentage %>%
              </div>
            </div>
            <small><%= p.topicsCompleted.length %> / <%= p.totalTopics || "?" %> topics</small>
          </div>
        <% }) %>
      <% } else { %>
        <p>No progress data yet. Start learning to see updates!</p>
      <% } %>
    </div>
  </div>

  <!-- Study Plan Summary -->
  <div class="card">
    <div class="card-header bg-warning">Study Plan</div>
    <div class="card-body">
      <% if(studyPlan && studyPlan.plan && studyPlan.plan.length > 0){ %>
        <p><strong>Exam Date:</strong> <%= studyPlan.examDate ? new Date(studyPlan.examDate).toDateString() : "Not set" %></p>
        <ul class="list-group">
          <% studyPlan.plan.slice(0,5).forEach(day => { %>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span>
                <strong><%= new Date(day.date).toDateString() %>:</strong> 
                <%= day.subject %> → <%= day.tasks.join(", ") %>
              </span>
              <% if(day.completed){ %>
                <span class="badge bg-success">✔ Done</span>
              <% } else { %>
                <span class="badge bg-secondary">Pending</span>
              <% } %>
            </li>
          <% }) %>
        </ul>
        <a href="/progress/studyplan" class="btn btn-sm btn-outline-primary mt-2">View Full Study Plan</a>
      <% } else { %>
        <p>No study plan yet. <a href="/progress/studyplan">Generate one here</a>.</p>
      <% } %>
    </div>
  </div>

  <!-- Quiz Scores -->
  <div class="card">
    <div class="card-header bg-info text-white">Quiz Results</div>
    <div class="card-body">
      <% if(quizScores && quizScores.length > 0){ %>
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Quiz</th>
              <th>Score</th>
              <th>Percentage</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody>
            <% quizScores.forEach(q => { %>
              <tr>
                <td><%= q.quizId ? q.quizId.title : "Deleted Quiz" %></td>
                <td><%= q.score %> / <%= q.maxScore %></td>
                <td><%= q.percentage %>%</td>
                <td><%= new Date(q.completedAt).toLocaleDateString() %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% } else { %>
        <p>No quiz attempts yet. Try a <a href="/quiz">quiz</a>!</p>
      <% } %>
    </div>
  </div>

  <!-- Links -->
  <div class="d-flex justify-content-between mt-3">
    <a href="/progress/leaderboard" class="btn btn-outline-dark">🏆 View Leaderboard</a>
    <a href="/progress/studyplan" class="btn btn-outline-success">📅 Manage Study Plan</a>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
