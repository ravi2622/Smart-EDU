<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard - Smart EDU</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
  <style>
    :root {
      --primary-color: #4A90E2;
      --secondary-color: #6C757D;
      --accent-color: #17A2B8;
      --background-color: #F8F9FA;
      --card-bg: #FFFFFF;
      --sidebar-bg: #212529;
      --text-color: #343A40;
      --light-text: #ADB5BD;
    }

    body {
      background: var(--background-color);
      color: var(--text-color);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    .sidebar {
      min-height: 100vh;
      background: var(--sidebar-bg);
      color: #fff;
      transition: all 0.3s ease;
    }

    .sidebar .user-info {
      display: flex;
      align-items: center;
      padding: 1.5rem 1rem;
    }

    .sidebar .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #fff;
      margin-right: 12px;
    }

    .sidebar a {
      color: var(--light-text);
      text-decoration: none;
      display: flex;
      align-items: center;
      padding: 12px 1rem;
      border-radius: 8px;
      margin: 4px 0;
      transition: background 0.2s ease, color 0.2s ease;
    }

    .sidebar a:hover {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
    }

    .sidebar a i {
      font-size: 1.25rem;
      margin-right: 12px;
    }

    .card {
      border-radius: 12px;
      border: none;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
      background-color: var(--card-bg);
      transition: transform 0.2s ease;
    }

    .card:hover {
      transform: translateY(-3px);
    }

    .progress {
      height: 25px;
      border-radius: 12px;
    }

    .progress-bar {
      border-radius: 12px;
      font-weight: bold;
    }

    .quick-link-card {
      border-radius: 12px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .quick-link-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    }

    .quick-link-card .bi {
      font-size: 3rem;
    }

    .header-icons .bi {
      font-size: 1.5rem;
    }
  </style>
</head>
<body>

<div class="container-fluid">
  <div class="row">
    <nav class="col-md-3 col-lg-2 d-md-block sidebar p-0">
      <div class="p-3 d-flex flex-column h-100">
        <h4 class="text-white mb-3">Smart EDU</h4>
        <div class="user-info mb-3">
          <div class="user-avatar bg-secondary"></div>
          <p class="small m-0">Hello, <br><strong><%= user.name %></strong></p>
        </div>
        <a href="/dashboard"><i class="bi bi-speedometer2"></i> Dashboard</a>
        <a href="/notes"><i class="bi bi-journal-text"></i> Notes</a>
        <a href="/quiz"><i class="bi bi-question-circle"></i> Quizzes</a>
        <a href="/forum"><i class="bi bi-chat-left-text"></i> Forum</a>
        <a href="/ai/study-plan"><i class="bi bi-robot"></i> AI Study Plan</a>
        <a href="/dashboard/profile"><i class="bi bi-person-circle"></i> Profile</a>
        <div class="mt-auto">
          <a href="/logout" class="text-danger"><i class="bi bi-box-arrow-right"></i> Logout</a>
        </div>
      </div>
    </nav>

    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Dashboard</h1>
        <div class="btn-toolbar mb-2 mb-md-0 header-icons">
          <button type="button" class="btn btn-light"><i class="bi bi-bell"></i></button>
        </div>
      </div>

      <% if (success_msg && success_msg.length) { %><div class="alert alert-success"><%= success_msg %></div><% } %>
      <% if (error_msg && error_msg.length) { %><div class="alert alert-danger"><%= error_msg %></div><% } %>

      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <h4 class="mb-1 text-primary">Welcome, <%= user.name %>!</h4>
          <p class="text-muted">Your role: <strong><%= user.role %></strong></p>
          <h6 class="mt-3">Your Overall Progress</h6>
          <div class="progress mb-2">
            <div class="progress-bar bg-primary" role="progressbar"
                 style="width: <%= overallProgress %>%"
                 aria-valuenow="<%= overallProgress %>" aria-valuemin="0" aria-valuemax="100">
              <%= overallProgress %>%
            </div>
          </div>
        </div>
      </div>

      <div class="row mb-4 g-4">
        <div class="col-md-3">
          <a href="/notes" class="card quick-link-card text-center text-decoration-none">
            <div class="card-body">
              <i class="bi bi-journal-text text-primary"></i>
              <h6 class="mt-2 text-primary">Notes</h6>
            </div>
          </a>
        </div>
        <div class="col-md-3">
          <a href="/quiz" class="card quick-link-card text-center text-decoration-none">
            <div class="card-body">
              <i class="bi bi-question-circle text-success"></i>
              <h6 class="mt-2 text-success">Quizzes</h6>
            </div>
          </a>
        </div>
        <div class="col-md-3">
          <a href="/forum" class="card quick-link-card text-center text-decoration-none">
            <div class="card-body">
              <i class="bi bi-chat-left-text text-warning"></i>
              <h6 class="mt-2 text-warning">Forum</h6>
            </div>
          </a>
        </div>
        <div class="col-md-3">
          <a href="/ai/study-plan" class="card quick-link-card text-center text-decoration-none">
            <div class="card-body">
              <i class="bi bi-robot text-danger"></i>
              <h6 class="mt-2 text-danger">AI Study Plan</h6>
            </div>
          </a>
        </div>
      </div>

      <div class="row g-4">
        <div class="col-md-6 mb-4">
          <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">Recent Notes</div>
            <ul class="list-group list-group-flush">
              <% if (recentNotes.length > 0) { %>
                <% recentNotes.forEach(note => { %>
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                      <strong><%= note.title %></strong>
                      <br><small class="text-muted">by <%= note.uploadedBy ? note.uploadedBy.name : "Unknown" %></small>
                    </div>
                    <a href="/notes/download/<%= note._id %>" class="btn btn-sm btn-outline-primary">Download</a>
                  </li>
                <% }) %>
              <% } else { %>
                <li class="list-group-item text-muted">No notes uploaded yet.</li>
              <% } %>
            </ul>
          </div>
        </div>

        <div class="col-md-6 mb-4">
          <div class="card shadow-sm">
            <div class="card-header bg-success text-white">Available Quizzes</div>
            <ul class="list-group list-group-flush">
              <% if (availableQuizzes.length > 0) { %>
                <% availableQuizzes.forEach(quiz => { %>
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                      <strong><%= quiz.title %></strong>
                      <br><small class="text-muted">by <%= quiz.createdBy ? quiz.createdBy.name : "Unknown" %></small>
                    </div>
                    <a href="/quiz/take/<%= quiz._id %>" class="btn btn-sm btn-outline-success">Take Quiz</a>
                  </li>
                <% }) %>
              <% } else { %>
                <li class="list-group-item text-muted">No quizzes available yet.</li>
              <% } %>
            </ul>
          </div>
        </div>
      </div>

      <div class="card shadow-sm mb-5">
        <div class="card-header bg-warning">Recent Forum Questions</div>
        <ul class="list-group list-group-flush">
          <% if (recentQuestions.length > 0) { %>
            <% recentQuestions.forEach(q => { %>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <a href="/forum/<%= q._id %>" class="text-decoration-none text-dark"><strong><%= q.title %></strong></a>
                  <br><small class="text-muted">asked by <%= q.askedBy ? q.askedBy.name : "Anonymous" %></small>
                </div>
                <div>
                  <span class="badge bg-secondary me-2">
                    <i class="bi bi-chat-fill"></i> <%= q.repliesCount || 0 %>
                  </span>
                  <a href="/forum/<%= q._id %>" class="btn btn-sm btn-outline-warning">View</a>
                </div>
              </li>
            <% }) %>
          <% } else { %>
            <li class="list-group-item text-muted">No questions yet.</li>
          <% } %>
        </ul>
      </div>
    </main>
  </div>
</div>

</body>
</html>